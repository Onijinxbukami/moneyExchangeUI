<!DOCTYPE html>
<html>
<head>
  <base href="$FLUTTER_BASE_HREF">
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">

  <!-- iOS meta tags & icons -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="flutter_application_1">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>flutter_application_1</title>
  <link rel="manifest" href="manifest.json">

  <script>
    // The value below is injected by flutter build, do not touch.
    const serviceWorkerVersion = null;
  </script>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-storage.js"></script>

  <script>
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '1138420431027567', // Thay thế bằng appId của bạn
        cookie     : true,
        xfbml      : true,
        version    : 'v12.0'
      });
  
      console.log("Facebook SDK đã khởi tạo thành công!");
  
      // Cập nhật trạng thái SDK đã sẵn sàng
      window.facebookSDKReady = true;
  
      // Kiểm tra trạng thái đăng nhập của người dùng
      FB.getLoginStatus(function(response) {
        if (response.status === 'connected') {
          console.log('User is already logged in');
          // Đăng nhập Firebase với accessToken nếu người dùng đã đăng nhập
          var accessToken = response.authResponse.accessToken;
          // Gọi hàm Dart để xử lý đăng nhập Firebase với token
          window.flutter_inappwebview.callHandler('facebookLogin', accessToken);
        } else {
          console.log('User is not logged in');
          // Gọi FB.login để yêu cầu người dùng đăng nhập nếu chưa đăng nhập
          FB.login(function(response) {
            if (response.status === 'connected') {
              console.log('Successfully logged in');
              var accessToken = response.authResponse.accessToken;
              // Gọi hàm Dart để xử lý đăng nhập Firebase với token
              window.flutter_inappwebview.callHandler('facebookLogin', accessToken);
            } else {
              console.log('Login failed');
            }
          }, {scope: 'email,public_profile'});
        }
      });
    };
  
    // Thêm mã tải SDK Facebook
    (function(d, s, id){
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) {return;}
      js = d.createElement(s); js.id = id;
      js.src = "https://connect.facebook.net/en_US/sdk.js";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
  </script>
  

  <!-- Firebase Configuration -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBzuPV735m2wGpkHC7OHPKzR9VhmZzJY6U",
      authDomain: "auth-1d805.firebaseapp.com",
      projectId: "auth-1d805",
      storageBucket: "auth-1d805.firebasestorage.app",
      messagingSenderId: "1049850024670",
      appId: "1:1049850024670:web:adc8ddef4ffec8d08c284f",
      measurementId: "G-S39GYGE405"
    };
    firebase.initializeApp(firebaseConfig);
  </script>

  <!-- Flutter Initialization -->
  <script src="flutter.js" defer></script>
</head>

<body>
  <script>
    window.addEventListener('load', function(ev) {
      // Download main.dart.js and initialize Flutter
      _flutter.loader.loadEntrypoint({
        serviceWorker: {
          serviceWorkerVersion: serviceWorkerVersion,
        },
        onEntrypointLoaded: function(engineInitializer) {
          engineInitializer.initializeEngine().then(function(appRunner) {
            appRunner.runApp();
          });
        }
      });
    });
  </script>
</body>
</html>
